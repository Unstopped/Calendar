<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style/style.css">
</head>

<body>

    <div class="calendar">
        <div class="header">
            <span onclick="calendarShow('year')">Year</span>
            <span onclick="calendarShow('month')">Month</span>
            <!-- <span onclick="calendarShow('week')">Week</span> -->
            <span onclick="calendarShow('day')">Day</span>
        </div>
        <div id="year">
            <div class="year-grid" id="year-calendar">
            </div>
        </div>
        <div id="month" style="display:none">

        </div>
        <div id="day" style="display:none">
            <div id="day-grid">

            </div>
        </div>
        <div class="controls">
            <div class="back" onclick="previous()">
                <-- </div>
                    <div class="forward" onclick="next()"> --> </div>
            </div>


        </div>
    </div>
    <script async>
        let monthCalendarName = "month-calendar-big";
        let loaded = "year";
// TODO: Weeknummers
let previousMonthColor = "#181E28";
        let date = new Date();
        let year = document.getElementById("year");
        let month = document.getElementById("month");
        // let week = document.getElementById("week");
        let day = document.getElementById("day");
        let monthCalendar = document.getElementById("month");
        let yearCalendar = document.getElementById("year-calendar");
        let weekCalendar = document.getElementById("week-calendar");
        let dayCalendar = document.getElementById("day-grid");
        let beginTime = 7; //add php import from database (when the day should begin (earliest))
        let endTime = 20; //add php import from database (when the day should end (max))
        let rooms = 3; //add php import from database (the amount of rooms in the dentist)
        let roomtext = "kamer";// examples [room,room number,kamer,kamer nummer,oda,odanumarasi]
        let plannerColor = "#74B6CF";
        let blinkColorOne = "rgb(255, 42, 113)";//the color for the alert 
        let blinkColorTwo = "rgb(255, 236, 153)";//the color for the alert 
        let dayNames = ["Ma","Di",'Wo',"Do","Vr",'Za','Zo'];//the days of the weeks in text form
        let boxCount = 42;//the amount of boxes in a month
        let currentDayName = dayNames[date.getDay()];
        let currentDay = date.getDate();
        let currentMonth = date.getMonth();
        let currentYear = date.getFullYear();
        let monthNames = ["Januari","Februari","Maart","April","Mei","Juni","Juli","Augustus","September","Oktober","November","December"];
        //patient examples
        let reservations = [{room:1,plan:"implant",name:"Mustafa Kemal",from:8,end:12,warning:"medisch",day:2,month:2,year:2022},
        {room:2,plan:"dolgu",name:"Sabri Tas",from:9,end:10,warning:"Ebola",day:2,month:2,year:2022},
        {room:2,plan:"dolgu",name:"Henk Steen",from:13,end:16,warning:"ziekte",day:2,month:2,year:2022},
        {room:3,plan:"dolgu",name:"Hassan Vermez",from:13,end:13.5,warning:"ziekte",day:2,month:2,year:2022}
    ];
    //function to get the day of the week starting from monday instead of sunday
    function getWeekDay(d) {
        if(d < 0){
            return 6;
        }else{
            return d-1;
        }
    }
    function next(){
        if(loaded == "month"){
            if(currentMonth == 11){
                currentYear++;
                currentMonth = 0;
            }else{
                currentMonth++;
            }
            addDaysToMonth(monthCalendarName,currentDay,currentMonth,currentYear);
        }else if(loaded == "year"){

        }else if(loaded == "day"){

        }
    }
    function previous(){
        if(loaded == "month"){
            if(currentMonth == 0){
                currentYear--;
                currentMonth = 11;
            }else{
                currentMonth--;
            }
            addDaysToMonth(monthCalendarName,currentDay,currentMonth,currentYear);
        }else if(loaded == "year"){

        }else if(loaded == "day"){

        }
    }
    function load(){
        createRooms();
        createMonth()
        createYear();
    }
    function getDaysInMonth (month, year) {
        let val = new Date(year, month, 0).getDate();
    return val;
}
    function addDaysToMonth(elementName,day,month,year){
        let newDate = new Date(year,month,day);
        let previousMonth = getDaysInMonth(month,year);
        let daysInMonth = getDaysInMonth(month + 1,year);
        let element = document.getElementById(elementName);
        let beginDay = getWeekDay(new Date(year,month,1).getDay());
        let childNodes = element.childNodes;
        let dayCounter = 0;
        previousMonth -= beginDay;
        let endMonthGrid =  daysInMonth + beginDay;
        document.getElementById("month-name").innerText = monthNames[month] + " - " + year ;
        for (let i = 0; i < beginDay; i++) {
            
            let div = childNodes[i];
            
            previousMonth++;
            
           
           if(div.ELEMENT_NODE){
            div.innerText = previousMonth;
            div.className = "other-month";
           }

            
        }
       for (let i = beginDay; i < endMonthGrid; i++) {
           
           let div = childNodes[i];
           dayCounter++;
           if(div.ELEMENT_NODE){
               div.className = "";
            div.innerText = dayCounter;
           }
           
       }
       for (let i = endMonthGrid; i < boxCount ; i++) {
        let div = childNodes[i];
           if(div.ELEMENT_NODE){
            div.innerText = i - endMonthGrid + 1;
            div.className = "other-month";
           }
           
       }
    }
    function resetPlan(){
        
    }
        function planRooms(){
            reservations.forEach(reservation => {
                let start = reservation.from;
                let end = reservation.end;
                let room = reservation.room
                let planContainer = document.getElementById("room"+ room + "-hour" + start );
                let warning = document.createElement("span");
                planContainer.innerText = reservation.name + " - " + reservation.plan;
                planContainer.style.backgroundColor = plannerColor;
                planContainer.style.border = "none";
                planContainer.style.color = "white";
                if(start == end){
                        warning.className = "warning";
                        if(reservation.warning != undefined && reservation.warning != null && reservation.warning != ""){
                            warning.innerText = "Waarschuwing " + reservation.warning;
                        }
                        
                        warning.style.marginTop = "10px";
                        planContainer.appendChild(warning);
                }else{
                    for (let i = 0; i < end-start + 0.5; i+=0.5) {
                    let fullPlan = document.getElementById("room" + room + "-hour" + (start + i)) ;
                    fullPlan.style.backgroundColor = plannerColor;
                    
                    if((start + i ) < end){
                        fullPlan.style.border = "none";
                    }else if((start + i) >= end){

                        warning.className = "warning";
                        if(reservation.warning != undefined && reservation.warning != null && reservation.warning != ""){
                            warning.innerText = "Waarschuwing " + reservation.warning;
                            fullPlan.appendChild(warning);
                        }
                        
                    }
                }
                }
               
                
            });
        }
        function createRooms() {
            
            for (let i = 0; i < rooms; i++) {
                let roomContainer = document.createElement("div");
                roomContainer.id="room-container"
                let roomName = document.createElement("h2");
                let room = document.createElement("div");
                room.id = "room" + (i + 1);
                room.className="room";
                for (let x = 0; x <= (endTime - beginTime); x+= 0.5) {
                    let tempTime = ((beginTime) + (x));
                    let hour = document.createElement("span");
                    let planner = document.createElement("span");
                    planner.id = "room"+(i + 1)+"-hour"+ tempTime;;
                    planner.className="reservation";
                    let hourEnding = ((tempTime) > Math.floor(tempTime)) ? "30" : "00";

                    if (tempTime  < 10) {
                        hour.innerText = "0" + Math.floor(tempTime) + ":"+hourEnding;
                    } else {
                        hour.innerText = Math.floor(tempTime)+ ":"+hourEnding;
                    }
                    
                    room.appendChild(hour);
                    room.appendChild(planner);
                }
                roomName.innerText = roomtext + " " + (i+1);
                dayCalendar.appendChild(roomContainer);
                roomContainer.appendChild(roomName);
                roomContainer.appendChild(room);
                
            }
            planRooms();
        }
        function createMonth() {
            let monthName = document.createElement("h2");
            monthName.innerText = monthNames[currentMonth];
            monthName.id = "month-name";
            monthCalendar.appendChild(monthName);
            let monthGrid = document.createElement("div");
            monthGrid.id ="month-calendar-big";
            monthGrid.className = "month-grid";
            let nameContainer = document.createElement("div");
            nameContainer.className="name-grid";
            for (let i = 0; i < dayNames.length; i++) {
                let dayName = document.createElement("div");
                dayName.className = "names";
                dayName.innerText = dayNames[i];
                nameContainer.appendChild(dayName);
                
            }
            monthCalendar.appendChild(nameContainer);
            for (let i = 0; i < boxCount; i++) {
                let dayDiv = document.createElement('div');
                dayDiv.id = "month-day-"+i;
                monthGrid.appendChild(dayDiv);
            }
            monthCalendar.appendChild(monthGrid);
            addDaysToMonth(monthCalendarName,currentDay,currentMonth,currentYear);
        }
        function calendarShow(type) {

            if (type == "month") {
                //month calendar
                loaded = "month";
                // week.style.display = "none";
                month.style.display = "block";
                day.style.display = "none";
                year.style.display = "none";
            }
            else if (type == "year") {
                loaded = "year";
                // week.style.display = "none";
                month.style.display = "none";
                day.style.display = "none";
                year.style.display = "block";

            }
            else if (type == "day") {
                loaded = "day";
                // week.style.display = "none";
                month.style.display = "none";
                day.style.display = "block";
                year.style.display = "none";
            }
        }
        
        function createYear(){
            
            for (let i = 0; i < monthNames.length; i++) {
                let monthYear = document.createElement("div");
                monthYear.id = "month-" + monthNames[i];
                monthYear.className = "month-year";
                let title = document.createElement("h1");
                title.id = "year-month-name";
                title.innerText = monthNames[i];
                monthYear.appendChild(title);
                let nameGrid = document.createElement("div");
                nameGrid.className = "name-grid";
                for (let i = 0; i < 7; i++) {
                    let name = document.createElement("div");
                    name.innerText = dayNames[i];
                    name.className = "names";
                    nameGrid.appendChild(name);
                }
                monthYear.appendChild(nameGrid);
                let monthCalendar = document.createElement("div");
                monthCalendar.id = "month-calendar";
                monthCalendar.className = "month-grid";
                for (let i = 0; i < boxCount; i++) {
                    let box = document.createElement("div");
                    monthCalendar.appendChild(box);
                    
                }
                monthYear.appendChild(monthCalendar);
                
                yearCalendar.appendChild(monthYear);
                
            }
            
        }
        myInterval = setInterval(warningAlert, 500);
 
        function warningAlert() {
        let warning = document.getElementsByClassName("warning");
        for (let i = 0; i < warning.length; i++) {
            warning[i].style.backgroundColor = warning[i].style.backgroundColor == blinkColorOne ? blinkColorTwo : blinkColorOne;
            
        }
        
        }
        load();
    </script>
</body>

</html>